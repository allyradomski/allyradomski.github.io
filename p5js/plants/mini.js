function create_leaf(){return{pos:{x:0,y:0,z:0},rot:{i:0,j:0,k:0},fold:.8,width:200,height:500,res:20,shape:0,curve:1}}function draw_leaf(a){function c(a,b){return a=map(constrain(a,0,1),0,1,0,PI),b=constrain(b,0,1),sin(a-sin(a)*b)}function b(b){push(),b=map(b,-1,1,PI-HALF_PI,PI+HALF_PI),beginShape(TRIANGLE_STRIP);for(let d=0;d<a.res;d++){let e=map(d,0,a.res,0,1),g=map(d+1,0,a.res,0,1),f=.25*sin(e*TWO_PI*a.curve)*a.width;vertex(e*a.height,c(e,a.shape)*cos(b)*a.width*.5-.5*f,c(e,a.shape)*sin(b)*a.width*.5),vertex(g*a.height,-f,0)}endShape(),pop()}push(),translate(a.pos.x,a.pos.y,a.pos.z),rotateX(a.rot.i),rotateY(a.rot.j),rotateZ(a.rot.k),b(a.fold),b(-a.fold),pop()}function create_trunk(){return{points:[],res:20}}let trunk_height,res,leaves=[],trunks=[],container,paused=!1,fix_time=!1,time_elapsed=0,last_time=0,text_height=45,text_width=160,seed,lines=[],colours=[["#000000","#ffffff"],["#000000","#00ff00"],["#000000","#ff7fff"]];function draw_trunk(a){for(let b=0;b<a.points.length-1;b++){beginShape(TRIANGLE_STRIP);for(let c=-2;c<a.res;c++){let d=map(c,0,a.res,0,TWO_PI),e=map(c+1,0,a.res,0,TWO_PI),f=a.points[b].r,g=a.points[b+1].r;vertex(a.points[b].x+sin(d)*f,a.points[b].y,a.points[b].z+cos(d)*f),vertex(a.points[b+1].x+sin(e)*g,a.points[b+1].y,a.points[b+1].z+cos(e)*g)}endShape()}}function preload(){let b=new URL(window.location.href),a=new URLSearchParams(b.search);a.has("seed")?!1==isNaN(parseInt(a.get("seed")))?seed=int(a.get("seed")):(seed=int(random(0,999999999)),a.set("seed",seed),window.location.search=a):(seed=int(random(0,999999999)),a.append("seed",seed),window.location.search=a),randomSeed(seed),noiseSeed(seed),document.title=seed}function setup(){container=document.getElementById("container");let f=floor(random(colours.length));document.body.style.backgroundColor=colours[f][0],container.style.color=colours[f][1],createCanvas(640,360,WEBGL),pixelDensity(1),windowResized(),res=50;let g=random(-HALF_PI,HALF_PI);trunk_height=random(500,1e3);let h=random(50,400),c=create_trunk();c.res=res;for(let b=0;b<10;b++){let i;i=0==b?0:50*pow(map(b,0,10,0,1),2)+20*noise(.1*b),c.points.push({x:pow(map(b,0,10,0,1),2)*h*sin(g),y:-map(b,0,9,0,-trunk_height),z:pow(map(b,0,10,0,1),2)*h*cos(g),r:i})}trunks.push(c);let k=random(-0.3,.5),j=random(.1,.6),l=random(100,400),m=random(300,500),n=random(.3,.6),o=random(0,.8),d=2*int(random(1,3))+3,p=random(0,.5),q=random(.1,.5);for(let e=0;e<d;e++){let a=create_leaf();a.pos.y=0,a.rot.j=e/float(d)*TWO_PI,a.rot.k=k-random(-j,j),a.fold=n+random(0,.2),a.width=l+random(0,80),a.height=m+random(0,100),a.shape=o+random(0,.2),a.curve=p+random(q),a.res=res,leaves.push(a)}lines[0]="seed : "+seed,lines[2]="leaves : "+d,lines[3]="space to pause",lines[4]="r for new seed"}function windowResized(){windowWidth<windowHeight*(16/9)?(container.style.width=windowWidth+"px",container.style.height=.5625*windowWidth+"px",container.style.top=(windowHeight-.5625*windowWidth)*.5+"px",container.style.left="0px",container.style.fontSize=.5625*windowWidth/float(text_height)*1+"px",container.style.lineHeight=.5625*windowWidth/float(text_height)*1+"px"):(container.style.width=windowHeight*(16/9)+"px",container.style.height=windowHeight+"px",container.style.top="0px",container.style.left=(windowWidth-windowHeight*(16/9))*.5+"px",container.style.fontSize=windowHeight/float(text_height)+"px",container.style.lineHeight=windowHeight/float(text_height)+"px")}function keyPressed(){if(32===keyCode)paused&&(fix_time=!0),paused=!paused;else if(82==keyCode){let b=new URL(window.location.href),a=new URLSearchParams(b.search);a.delete("seed"),window.location.search=a}}function draw(){if(paused)return;fix_time?(last_time=millis(),fix_time=!1):(time_elapsed+=millis()-last_time,last_time=millis()),strokeWeight(5),clear(),noFill(),background(0),stroke(255),translate(0,0,-500),translate(0,-(.1*trunk_height),0),rotateX(-(.4*HALF_PI)),rotateY(time_elapsed/8e3*TWO_PI),lines[1]="rot : "+(time_elapsed/8e3*TWO_PI%TWO_PI).toFixed(3);for(let d=0;d<leaves.length;d++)draw_leaf(leaves[d]);for(let e=0;e<trunks.length;e++)draw_trunk(trunks[e]);let h="",i=int(1/float(text_height)*height),j=int(1/float(text_width)*width),k="\u2591\u2593\u2588",l="\u2003.",q=time_elapsed/4e3,r=time_elapsed/32e3;loadPixels();for(let c=0;c<text_height;c++){let b="";for(let a=0;a<text_width;a++)if(0==c)0==a?b+="\u250F":a==text_width-1?b+="\u2513":b+="\u2501";else if(c==text_height-1)0==a?b+="\u2517":a==text_width-1?b+="\u251B":b+="\u2501";else if(0==a||a==text_width-1)b+="\u2503";else{if(c-2<=lines.length-1&&c-2>=0&&a-2<=lines[c-2].length-1&&a-2>=0){b+=lines[c-2][a-2];continue}let m=int(map(a,0,text_width,0,width)),n=int(map(c,0,text_height,0,height)),o=0;for(let f=m;f<m+j;f++)for(let g=n;g<n+i;g++)o+=red(pixels[(f+(height-g)*width)*4]);let p=int(map(o/(j*i),0,255,0,k.length-1));0==p?b+=l[int(map(noise(.01*a+0,.05*c+q,r),0,1,0,l.length))]:b+=k[p]}h+=b+"<br>"}container.innerHTML=h}